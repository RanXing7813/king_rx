<link  href="/theme/portals/js/zTree/css/demo.css" type="text/css" />
<link rel="stylesheet" href="/theme/portals/js/zTree/css/zTreeStyle/zTreeStyle.css" type="text/css" />
<script  src="/theme/portals/js/zTree/js/jquery-1.4.4.min.js"></script>
<script  src="/theme/portals/js/zTree/js/jquery.ztree.core-3.5.js"></script>
<script  src="/theme/portals/js/zTree/js/jquery.ztree.excheck-3.5.js"></script>
<script  src="/theme/portals/js/overalert.js"></script>
<script th:inline="javascript" >
/*<![CDATA[*/
var api = frameElement.api, W = api.opener;	
	
$(document).ready(function(){
		go();// 获取菜单list 
});        
//list数据 
function go(page){
	var map={};
	var idss= /*[[${_roleId}]]*/;
		map.id="'"+idss+"'";
		map.type=/*[[${_type}]]*/;
  $.ajax({
         url : "role-authMenus.json",
         dataType: "json", 
         data:{
       	  models : JSON.stringify(map)
         },
         type:"POST",
         success: function(result) { if(result==null)   return;
				var setting = {
					check: {
						enable: true
					},
					data: {
						simpleData: {
							enable: true
						}
					}
				};
				//console.log(result);
				var zNodes =result.list;
				var code;
				function showCode(str) {
					if (!code) code = $("#code");
					code.empty();
					code.append("<li>"+str+"</li>");
				}
				$(document).ready(function(){
					$.fn.zTree.init($("#treeDemo"), setting, zNodes);
					 var treeObj = $.fn.zTree.init($("#treeDemo"), setting, zNodes);
					 treeObj.expandAll(true);//展开所有节点
				});
         }
       });
}

// 得到父页面 属性 

api.button({
	 name: '分配确认',
     callback: auth,
     focus: true
},
{
    name: '取消',
}); 
//callback方法 
 function auth(){
	var map={};
		var ids= /*[[${_roleId}]]*/;
		map.id="'"+ids+"'";
	 if(ids.length>0 && submitan().length>0){
		 map.menuIds=submitan(); 
		//console.log(submitan());
		  $.ajax({
		         url : "role-authMenus-save.json",
		         dataType: "json", 
		         async: false,
		         data:{
		       	  models : JSON.stringify(map)
		         },
		         type:"POST",
		         success: function(result) { if(result==null)   return; 
		         }
		  });
     }else{
    	  $.MsgBox.Alert("温馨提示", "未选择角色!!!");
    	 
     }
		
		 
 }
 function submitan(){
        var treeObj=$.fn.zTree.getZTreeObj("treeDemo"),
        nodes=treeObj.getCheckedNodes(true),
        v="";
        for(var i=0;i<nodes.length;i++){
       	 v+=nodes[i].id + ",";
        //获取选中节点的值
        }
        if(v.length>0){
        	v=v.substring(0,v.length-1); 
        }
        //W.document.getElementById('xx').value = v;//给父页面id 传值 
        return v;
 }
 

 
 
 
 
/*]]>*/
</script>
<div class="content_wrap" >
	<div class="zTreeDemoBackground left" style=" overflow-y:scroll; width:auto; height:400px;">
		<ul id="treeDemo" class="ztree"></ul>
	</div>
</div>